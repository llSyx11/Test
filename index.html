<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Model Viewer</title>
    <style>
        body, html { margin: 0; overflow: hidden; height: 100%; }
        canvas { display: block; }
        #joystick-container { position: fixed; bottom: 10px; left: 10px; z-index: 10; }
        #right-joystick { position: fixed; bottom: 10px; right: 10px; z-index: 10; }
        .keyboard-controls { position: fixed; bottom: 20px; right: 20px; z-index: 10; color: white; font-size: 20px; display: none; }
        .keyboard-controls span { margin: 0 5px; cursor: pointer; }
    </style>
</head>
<body>

<!-- Display keyboard controls for desktop -->
<div class="keyboard-controls">
    <span>W</span><span>A</span><span>S</span><span>D</span>
</div>

<!-- For Joystick Controls -->
<div id="joystick-container"></div>
<div id="right-joystick"></div>

<!-- 3D Model Loader -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/loaders/GLTFLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/nipplejs@0.8.7/dist/nipplejs.min.js"></script>

<script>
    // Setting up scene, camera, renderer
    let scene, camera, renderer, model;
    let controlsEnabled = false;

    // Movement variables
    let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false;
    let rotateLeft = false, rotateRight = false;
    let moveSpeed = 0.1, rotateSpeed = 0.02;

    const clock = new THREE.Clock();

    // Initialize the scene, camera, and renderer
    function init() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Add lighting
        const light = new THREE.AmbientLight(0xffffff, 1);
        scene.add(light);

        // Load 3D model
        const loader = new THREE.GLTFLoader();
        loader.load('https://raw.githubusercontent.com/llsyx11/Test/main/001.glb', (gltf) => {
            model = gltf.scene;
            scene.add(model);
            model.scale.set(2, 2, 2);  // Adjust scale of the model
        });

        // Handle resize
        window.addEventListener('resize', onWindowResize, false);

        // Check for device and load controls accordingly
        if (window.innerWidth < 600) {
            setupMobileControls();
        } else {
            setupDesktopControls();
        }

        // Start animation loop
        animate();
    }

    // Handle window resizing
    function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }

    // Setup controls for mobile (using nipplejs)
    function setupMobileControls() {
        const joystick = nipplejs.create({
            zone: document.getElementById('joystick-container'),
            mode: 'static',
            position: { left: '10%', top: '70%' }
        });

        joystick.on('move', (evt, data) => {
            if (data.direction) {
                const { x, y } = data.direction;
                moveForward = y > 0;
                moveBackward = y < 0;
                moveLeft = x < 0;
                moveRight = x > 0;
            }
        });

        const rightJoystick = nipplejs.create({
            zone: document.getElementById('right-joystick'),
            mode: 'static',
            position: { left: '80%', top: '70%' }
        });

        rightJoystick.on('move', (evt, data) => {
            if (data.direction) {
                const { x, y } = data.direction;
                rotateLeft = x < 0;
                rotateRight = x > 0;
            }
        });
    }

    // Setup controls for desktop (keyboard)
    function setupDesktopControls() {
        const controls = document.querySelector('.keyboard-controls');
        controls.style.display = 'block';

        window.addEventListener('keydown', (event) => {
            switch (event.key) {
                case 'w': moveForward = true; break;
                case 's': moveBackward = true; break;
                case 'a': moveLeft = true; break;
                case 'd': moveRight = true; break;
            }
        });

        window.addEventListener('keyup', (event) => {
            switch (event.key) {
                case 'w': moveForward = false; break;
                case 's': moveBackward = false; break;
                case 'a': moveLeft = false; break;
                case 'd': moveRight = false; break;
            }
        });

        window.addEventListener('mousedown', (event) => {
            controlsEnabled = true;
        });

        window.addEventListener('mouseup', (event) => {
            controlsEnabled = false;
        });
    }

    // Animation loop
    function animate() {
        const delta = clock.getDelta();  // Time between frames

        if (model) {
            // Move the model based on keyboard or joystick inputs
            if (moveForward) model.position.z -= moveSpeed * delta;
            if (moveBackward) model.position.z += moveSpeed * delta;
            if (moveLeft) model.position.x -= moveSpeed * delta;
            if (moveRight) model.position.x += moveSpeed * delta;

            // Rotate the model based on joystick input
            if (rotateLeft) model.rotation.y += rotateSpeed;
            if (rotateRight) model.rotation.y -= rotateSpeed;

            // Rotate camera on mouse drag
            if (controlsEnabled) {
                document.addEventListener('mousemove', (event) => {
                    if (event.buttons === 1) {
                        camera.rotation.x -= event.movementY * 0.005;
                        camera.rotation.y -= event.movementX * 0.005;
                    }
                });
            }
        }

        // Render the scene
        renderer.render(scene, camera);

        // Update camera position and orientation
        camera.position.z = 5;
        requestAnimationFrame(animate);
    }

    // Initialize everything
    init();
</script>

</body>
</html>
