<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D Модель с Джойстиками</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      position: relative;
    }
    canvas {
      display: block;
    }
    /* Стили для мобильных джойстиков */
    #joystick-container {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    /* Для стилизации иконок WASD */
    .wasd-buttons {
      position: absolute;
      right: 10px;
      bottom: 10px;
      font-size: 24px;
      color: white;
      background-color: rgba(0, 0, 0, 0.5);
      padding: 5px;
      display: none; /* Скрываем на мобильных устройствах */
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/jsm/loaders/GLTFLoader.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/nipplejs@0.8.4/dist/nipplejs.min.js"></script>
</head>
<body>
  <div id="joystick-container"></div>
  <div class="wasd-buttons">
    W A S D
  </div>

  <script>
    let scene, camera, renderer, model;
    let controls = { moveX: 0, moveZ: 0, rotateY: 0 };
    let isMobile = /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent); // Проверка на мобильное устройство
    let keys = { W: false, A: false, S: false, D: false };

    function init() {
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      renderer = new THREE.WebGLRenderer();
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      // Освещение
      const light = new THREE.AmbientLight(0x404040);
      scene.add(light);

      // Инициализация загрузчика
      const loader = new THREE.GLTFLoader();
      loader.load(
        'https://raw.githubusercontent.com/llSyx11/Test/main/001.glb',
        (gltf) => {
          model = gltf.scene;
          scene.add(model);
        },
        undefined,
        (error) => {
          console.error('Ошибка загрузки модели:', error);
        }
      );

      camera.position.z = 5;
      initControls();
      animate();
    }

    function animate() {
      requestAnimationFrame(animate);

      // Управление для мобильных устройств (джойстики)
      if (isMobile) {
        if (model) {
          model.rotation.y += controls.rotateY;
          model.position.x += controls.moveX;
          model.position.z += controls.moveZ;
        }
      } else {
        // Управление для ПК (клавиши WASD + мышь)
        if (keys.W) controls.moveZ = -0.1;
        if (keys.S) controls.moveZ = 0.1;
        if (keys.A) controls.moveX = -0.1;
        if (keys.D) controls.moveX = 0.1;
        
        if (model) {
          model.rotation.y += controls.rotateY;
          model.position.x += controls.moveX;
          model.position.z += controls.moveZ;
        }
      }

      renderer.render(scene, camera);
    }

    function initControls() {
      if (isMobile) {
        initJoystick();
      } else {
        initKeyboardControls();
        initMouseControls();
      }

      // Обновляем рендерер и камеру при изменении размера окна
      window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });
    }

    // Инициализация джойстиков для мобильных устройств
    function initJoystick() {
      const joystickContainer = document.getElementById('joystick-container');

      // Левый джойстик для перемещения
      const leftJoystick = nipplejs.create({
        zone: joystickContainer,
        mode: 'static',
        position: { left: '10%', bottom: '10%' },
        color: 'blue',
      });

      leftJoystick.on('move', (evt, data) => {
        controls.moveX = data.vector.x * 0.1;
        controls.moveZ = -data.vector.y * 0.1;
      });

      // Правый джойстик для вращения
      const rightJoystick = nipplejs.create({
        zone: joystickContainer,
        mode: 'static',
        position: { right: '10%', bottom: '10%' },
        color: 'green',
      });

      rightJoystick.on('move', (evt, data) => {
        controls.rotateY = data.vector.x * 0.02; // Поворот модели
      });

      rightJoystick.on('end', () => {
        controls.rotateY = 0;
      });
    }

    // Инициализация клавиш WASD для ПК
    function initKeyboardControls() {
      window.addEventListener('keydown', (event) => {
        if (event.key === 'W') keys.W = true;
        if (event.key === 'A') keys.A = true;
        if (event.key === 'S') keys.S = true;
        if (event.key === 'D') keys.D = true;
      });

      window.addEventListener('keyup', (event) => {
        if (event.key === 'W') keys.W = false;
        if (event.key === 'A') keys.A = false;
        if (event.key === 'S') keys.S = false;
        if (event.key === 'D') keys.D = false;
      });
    }

    // Инициализация мыши для вращения
    function initMouseControls() {
      let mouseX = 0;
      let mouseY = 0;

      window.addEventListener('mousemove', (event) => {
        mouseX = event.clientX;
        mouseY = event.clientY;
        controls.rotateY = (mouseX - window.innerWidth / 2) * 0.002; // Мышь управляет вращением
      });
    }

    init();
  </script>
</body>
</html>
