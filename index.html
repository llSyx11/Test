<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ... (остальные части остаются без изменений) ... -->
</head>
<body>
    <!-- ... (остальные части остаются без изменений) ... -->

    <script>
        let scene, camera, renderer, model;
        let isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
        let moveSpeed = 3;
        let clock = new THREE.Clock();
        let keyState = {};
        
        // Переменные для управления камерой
        let yaw = 0;
        let pitch = 0;
        let isMouseDown = false;
        let prevMouseX = 0;
        let prevMouseY = 0;

        init();
        animate();

        function init() {
            // ... (инициализация сцены, камеры, рендерера и модели остается без изменений) ... 

            // Освещение и загрузка модели
            // ... (без изменений) ...

            // Настройка элементов управления
            if(isMobile) setupMobileControls();
            else setupDesktopControls();

            // ... (обработчик изменения размера окна остается без изменений) ...
        }

        function setupDesktopControls() {
            document.querySelector('.keyboard-controls').style.display = 'block';

            // Обработчики клавиатуры
            window.addEventListener('keydown', e => {
                const key = e.key.toLowerCase();
                if(['w','a','s','d'].includes(key)) keyState[key] = true;
            });
            
            window.addEventListener('keyup', e => {
                const key = e.key.toLowerCase();
                if(['w','a','s','d'].includes(key)) keyState[key] = false;
            });

            // Обработчики мыши
            document.addEventListener('mousedown', e => {
                isMouseDown = true;
                prevMouseX = e.clientX;
                prevMouseY = e.clientY;
            });

            document.addEventListener('mousemove', e => {
                if (!isMouseDown) return;
                
                const deltaX = e.clientX - prevMouseX;
                const deltaY = e.clientY - prevMouseY;
                prevMouseX = e.clientX;
                prevMouseY = e.clientY;

                // Обновляем углы поворота
                yaw -= deltaX * 0.002;
                pitch = THREE.MathUtils.clamp(pitch - deltaY * 0.002, -Math.PI/2, Math.PI/2);

                // Применяем поворот к камере
                camera.quaternion.setFromEuler(new THREE.Euler(pitch, yaw, 0, 'YXZ'));
            });

            document.addEventListener('mouseup', () => isMouseDown = false);
        }

        function animate() {
            requestAnimationFrame(animate);
            const delta = clock.getDelta();

            if(!isMobile) {
                // Движение камеры
                const direction = new THREE.Vector3();
                const forward = new THREE.Vector3();
                const right = new THREE.Vector3();

                // Получаем направления камеры
                camera.getWorldDirection(forward);
                forward.y = 0; // Игнорируем вертикальную составляющую
                forward.normalize();
                right.crossVectors(new THREE.Vector3(0, 1, 0), forward).normalize();

                // Рассчитываем направление движения
                if(keyState['w']) direction.add(forward);
                if(keyState['s']) direction.sub(forward);
                if(keyState['a']) direction.sub(right);
                if(keyState['d']) direction.add(right);

                // Нормализуем и применяем движение
                if(direction.length() > 0) direction.normalize();
                camera.position.addScaledVector(direction, moveSpeed * delta);
            } else {
                // Мобильное управление (остается без изменений)
                if(model) {
                    model.position.x += moveVector.x * moveSpeed * delta;
                    model.position.z += moveVector.y * moveSpeed * delta;
                }
            }

            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
